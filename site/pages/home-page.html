<link rel="import" href="../components/eric/eric-projects.html">
<dom-module id="home-page">
  <template>
    <style>
      #add {
        position: fixed;
        bottom: 20px;
        right: 20px;
      }
    </style>
    <div class="container">
      <div id="add" class="add-button">
        <a class="btn-floating btn-large waves-effect waves-light red" id="submitIdea">
            <i class="material-icons">add</i>
        </a>
      </div>
      <div id="projects"></div>
    </div>
  </template>
</dom-module>
<script>
  Polymer({
    is: "home-page",
    attached: function() {
        $('#submitIdea').click(function() {
            document.querySelector('app-router').go('/submitidea');
        });
        // check if we have a session cookie, if not, show login screen
        if ($.cookie('session') == undefined){
          // user is not logged in, send them to login
          document.querySelector('app-router').go('/login');
        }
        else {
          var userID = $.cookie('userID');
          var session = $.cookie('session');
          api(
            "getProjects",
            {
              userID,
              session
            },
            function(data){
              // we got the projects, load them to the page here
              data = JSON.parse(data);
              for (var project in data){
                project = data[project];
                $('#projects').append(
                  $('<eric-projects/>')
                    .attr('name', project.projectName)
                    .attr('desc', project.projectDesc)
                    .attr('projectid', project['_id']['$oid'])
                );
              }
            }
          )
        }
    }
  });
</script>
